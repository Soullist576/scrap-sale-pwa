<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡∏ú‡∏•‡∏û‡∏•‡∏≠‡∏¢‡πÑ‡∏î‡πâ (‡πÅ‡∏ö‡∏ö A)</title>

<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#007bff">

<style>
@import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');

:root{
  --page-w: 210mm;
  --page-h: 297mm;
  --pad-x: 14mm;
  --pad-y: 10mm;
  --text: #111;
  --muted: #666;
  --line: #000;
  --soft: #ddd;
}

*{ box-sizing:border-box; }
body{
  margin:0;
  padding:10px;
  font-family:'Sarabun', sans-serif;
  background:#525659;
  color:var(--text);
}

/* A4 Page */
.page{
  width: var(--page-w);
  min-height: var(--page-h);
  margin: auto;
  background:#fff;
  padding: var(--pad-y) var(--pad-x);
  box-shadow: 0 0 10px rgba(0,0,0,.45);
}

/* Header */
.header{
  text-align:center;
  margin-bottom: 8px;
}
.header h2{
  margin:0;
  font-size: 20px;
  text-decoration: underline;
}
.header h3{
  margin:4px 0 0 0;
  font-size: 16px;
  font-weight: 400;
  color: var(--muted);
}

/* Info layout */
.info{
  margin-top: 8px;
  padding: 8px 10px;
}
.info-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px 14px;
}
.field{
  display:grid;
  grid-template-columns: 120px 1fr;
  gap: 8px;
  align-items: end;
  font-size: 14px;
}
.field .label{
  font-weight:700;
  white-space:nowrap;
}
.control{
  width: 100%;
  font-family:'Sarabun', sans-serif;
  font-size: 14px;
  border: none;
  border-bottom: 1px dotted var(--line);
  background: transparent;
  padding: 2px 4px;
  outline: none;
}

/* Make select look clean */
select.control{
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  padding-right: 22px;
  background-image:
    linear-gradient(45deg, transparent 50%, #666 50%),
    linear-gradient(135deg, #666 50%, transparent 50%),
    linear-gradient(to right, transparent, transparent);
  background-position:
    calc(100% - 14px) 55%,
    calc(100% - 9px) 55%,
    0 0;
  background-size: 5px 5px, 5px 5px, 100% 100%;
  background-repeat: no-repeat;
}

/* Full-width row fields */
.field.wide{
  grid-column: 1 / -1;
  grid-template-columns: 120px 1fr;
}

/* Weight */
.weight-wrap{
  display:flex;
  align-items:end;
  gap: 8px;
}
.weight-wrap input{
  width: 120px;
  text-align:center;
}

/* Photo sections */
.section-title{
  margin: 10px 0 6px;
  font-size: 15px;
  font-weight: 700;
}
.photo-grid{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  margin-bottom: 10px;
}
.photo-item{
  border:1px solid var(--soft);
  padding: 3px;
  background:#fff;
  break-inside: avoid;
  page-break-inside: avoid;
}
.photo-item img{
  width:100%;
  height: 112px;
  object-fit: contain;
  background:#fff;
  border: 1px dashed #cfcfcf;
  cursor: pointer;
  display:block;
}

/* Signature */
.sig{
  margin-top: 10px;
  padding: 10px;
}
.signatures{
  break-inside: avoid;
  page-break-inside: avoid;
}
.sig-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 26px;
  text-align:center;
  font-size:14px;
}
.sig-box{
  display:flex;
  flex-direction:column;
  align-items:center;
}
.sig-line{
  width: 72%;
  border-top: 1px dashed var(--line);
  margin: 34px 0 6px;
}

/* Toolbar */
.toolbar{
  position: fixed;
  top: 10px; left: 10px;
  z-index: 100;
  background:#fff;
  padding: 10px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,.3);
}
.toolbar .row{
  display:flex;
  gap: 8px;
  flex-wrap:wrap;
}
.toolbar button{
  font-family:'Sarabun', sans-serif;
  font-weight:700;
  padding: 8px 14px;
  border: none;
  border-radius: 6px;
  cursor:pointer;
}
.btn-print{ background:#007bff; color:#fff; }
.btn-pdf{ background:#17a2b8; color:#fff; }
.btn-clear{ background:#111; color:#fff; }
.hint{
  margin: 6px 0 0;
  font-size: 12px;
  color: var(--muted);
}

/* ===== Print (Desktop / iOS) ===== */
@media print{
  body{ background:none; padding:0; }
  .page{
    margin:0;
    width:auto;
    min-height:auto;
    box-shadow:none;
    padding: var(--pad-y) var(--pad-x);
  }
  .toolbar{ display:none !important; }
  select.control{ background-image:none !important; }
  input.control, select.control{ border:none !important; }

  @page{
    size: A4 portrait;
    margin: 6mm;
  }

  .page{
    transform: scale(0.96);
    transform-origin: top left;
    padding-bottom: 0 !important;
  }

  .photo-item img{ height: 102px !important; }
  .sig{ margin-top: 6px !important; padding-top: 6px !important; }
  .sig-line{ margin: 28px 0 4px !important; }
}
</style>
</head>

<body>

<div class="toolbar">
  <div class="row">
    <button class="btn-print" onclick="window.print()">üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå</button>
    <button class="btn-pdf" onclick="exportPDF()">üìÑ Export PDF</button>
    <button class="btn-clear" onclick="location.reload()">‡∏•‡πâ‡∏≤‡∏á</button>
  </div>
  <div class="hint">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ (4 ‡∏£‡∏π‡∏õ/‡πÅ‡∏ñ‡∏ß) ‚Äî iPhone ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ä‡πâ Export PDF ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î URL/‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</div>
</div>

<div class="page">
  <div class="header">
    <h2>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ú‡∏•‡∏û‡∏•‡∏≠‡∏¢‡πÑ‡∏î‡πâ</h2>
    <h3>‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏¥‡∏ï‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ö‡∏Å‡∏ò‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏°</h3>
  </div>

  <div class="info">
    <div class="info-grid">
      <div class="field">
        <div class="label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢:</div>
        <input class="control" type="date" id="saleDateInput">
      </div>  
      <div class="field">
        <div class="label">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠:</div>
        <select class="control" id="buyer">
          <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠ --</option>
          <option>‡∏ô‡∏≤‡∏¢‡∏¢‡∏á‡∏¢‡∏∏‡∏ó‡∏ò ‡∏û‡∏•‡∏≤‡∏¢‡∏™‡∏∏‡∏Ç‡πÅ‡∏™‡∏á</option>
          <option>‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó A</option>
          <option>‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó B</option>
        </select>
      </div>

      <div class="field">
        <div class="label">‡∏ú‡∏π‡πâ‡∏Ç‡∏ô‡∏™‡πà‡∏á:</div>
        <input class="control" type="text" id="transporter" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏ô‡∏™‡πà‡∏á">
      </div>

      <div class="field">
        <div class="label">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ:</div>
        <input class="control" type="text" id="plate" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ">
      </div>

      <div class="field wide">
        <div class="label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏û‡∏•‡∏≠‡∏¢‡πÑ‡∏î‡πâ:</div>
        <select class="control" id="byproduct">
          <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ --</option>
          <option>‡πÄ‡∏®‡∏©‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏™‡∏†‡∏≤‡∏û</option>
          <option>‡πÄ‡∏®‡∏©‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏™‡∏†‡∏≤‡∏û</option>
          <option>‡πÄ‡∏®‡∏©‡∏≠‡∏≤‡∏´‡∏≤‡∏£ + ‡πÄ‡∏®‡∏©‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
        </select>
      </div>

      <div class="field wide">
        <div class="label">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å:</div>
        <div class="weight-wrap">
          <input class="control" type="text" id="weight" placeholder="6,300">
          <div style="font-weight:700;">‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°</div>
        </div>
      </div>
    </div>
  </div>

  <br>
  <div class="section-title">‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div><br>
  <div class="photo-grid" id="before"></div>

  <div class="section-title">‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div><br>
  <div class="photo-grid" id="middle"></div>

  <div class="section-title">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à</div><br>
  <div class="photo-grid" id="after"></div>

  <div class="sig signatures">
    <div class="sig-grid">
      <div class="sig-box"><br>
        <b>‡∏ú‡∏π‡πâ‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</b><br>
        <div class="sig-line"></div><br>
        <div>(______________________________________________)</div>
      </div>
      <div class="sig-box"><br>
        <b>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£</b><br>
        <div class="sig-line"></div><br>
        <div>(______________________________________________)</div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
/* PWA Service Worker */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./service-worker.js");
}

/* ===== ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡∏û.‡∏®. ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ===== */
const dateInput = document.getElementById("saleDateInput");

function formatThaiDate(iso) {
  if(!iso) return "";
  const [y, m, d] = iso.split("-");
  return `${parseInt(d)}/${parseInt(m)}/${parseInt(y) + 543}`;
}

dateInput.addEventListener("focus", (e) => {
  e.target.type = "date";
});

dateInput.addEventListener("blur", (e) => {
  if (e.target.value) {
    const displayStr = formatThaiDate(e.target.value);
    e.target.type = "text";
    e.target.value = displayStr;
  }
});

/* ===== ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ===== */
function placeholder(){
  return "data:image/svg+xml;charset=UTF-8," + encodeURIComponent(`
    <svg xmlns='http://www.w3.org/2000/svg' width='600' height='420'>
      <rect width='100%' height='100%' fill='#f5f5f5'/>
      <rect x='18' y='18' width='564' height='384' fill='none' stroke='#cfcfcf' stroke-width='4' stroke-dasharray='10 10'/>
      <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
            font-size='24' fill='#888' font-family='Sarabun'>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ</text>
    </svg>
  `);
}

function buildGrid(id){
  const box = document.getElementById(id);
  for(let i=0;i<4;i++){
    const wrap = document.createElement("div");
    wrap.className = "photo-item";

    const f = document.createElement("input");
    f.type = "file";
    f.accept = "image/*";
    f.capture = "environment";
    f.style.display = "none";

    const img = document.createElement("img");
    img.src = placeholder();
    img.onclick = ()=> f.click();

    f.onchange = ()=> {
      if(!f.files || !f.files[0]) return;
      const r = new FileReader();
      r.onload = e => img.src = e.target.result;
      r.readAsDataURL(f.files[0]);
    };

    wrap.appendChild(f);
    wrap.appendChild(img);
    box.appendChild(wrap);
  }
}

buildGrid("before");
buildGrid("middle");
buildGrid("after");

/* Export PDF */
function exportPDF(){
  const el = document.querySelector(".page");
  const opt = {
    margin:       [6, 6, 6, 6],
    filename:     '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡∏ú‡∏•‡∏û‡∏•‡∏≠‡∏¢‡πÑ‡∏î‡πâ.pdf',
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  { scale: 2, useCORS: true, backgroundColor: "#ffffff" },
    jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };
  html2pdf().set(opt).from(el).save();
}
</script>

</body>
</html>
